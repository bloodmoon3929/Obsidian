---
end-date: 2024-06-10
---


연구 코드(수정 전)
https://github.com/meimeiliu/GATE

## 사용되는 기술
[[GNN]]
[[auto encoder]]
[[사이킷런]]
[[넘파이 모듈]]
## 프로젝트의 개념

인간의 뇌의 연결도를 분석

비 지도 학습

뇌의 일부분의 값을 변경하였을 때의 변화율을 기록
같은 값이 나온다면 1, 정 반대의 값이 나온다면 -1로 기록
(범위는 -1~1)

1. 첫 번째 파일의 경우 값을 그대로 기록
[160, 160, 394]
397은 조사한 데이터의 수

2. 두 번째 파일의 경우 값에 절댓값을 씌워서 기록
(값이 정 반대 일지언정 뇌끼리의 연결성이 있다고 판단)
[160, 160, 394]
397은 조사한 데이터의 수

3. 그 후 두 파일을 합침
[160,160,2,394]

160을 다 하면 좋으나, out of memory가 나오기 때문에 그 중 중요하다고 판단한 34개에 대해서 실시

test 횟수는 자유이나 일단 100회 실시

실시 후 나온 그래프에 대해서 거의 동일한 값이 나와야 제대로 분석한 것
(분석 실패시 거의 단색으로 출력값이 나옴)

마지막으로 이것은 대칭 구조임으로 대각선을 그린 후 반절을 날림





## 진행
### [160, 160, 394] 배열에 저장(원본)
빈 배열 data_list에
asd파일의 경로에 저장된 .mat파일의 경로를 저장하고,
리스트를 numpy 배열로 변환 후 .mat파일로 저장 
```py
import scipy.io
import numpy as np
import os

# .mat 파일이 저장된 디렉토리 경로
directory = 'C:/Users/USER/Desktop/spectrum/asd'

# 모든 .mat 파일의 경로를 가져오기
mat_files = [os.path.join(directory, f) for f in os.listdir(directory) if f.endswith('.mat')]

# 데이터를 저장할 리스트 초기화
data_list = []

# 각 .mat 파일을 읽어서 데이터 리스트에 추가
for mat_file in mat_files:
    mat_data = scipy.io.loadmat(mat_file)
    data = mat_data['loaded_tensor_sub']  
    data_list.append(data)

# 리스트를 numpy 배열로 변환하여 3D 배열 생성
data_3d = np.stack(data_list, axis=1)

# 3D 배열을 .mat 파일로 저장
output_file = 'C:/Users/USER/Desktop/spectrum/output_data.mat'
scipy.io.savemat(output_file, {'loaded_tensor_sub': data_3d})

print(f"3D 배열이 {output_file} 경로에 정상 저장되었습니다.")

```
1. os.path.join
   경로와 문자열을 합치는 함수
   - directory : 파일의 경로
   - f : 뒤의 두 함수를 통하여 가져온 .mat 파일들의 이름 
2. os.listdir
   경로에 있는 파일의 목록을 반환하는 함수 
3. f.endswith
   문자열이 특정 접미사로 끝나는지 확인한 후, bool값을 반환
   f는 for문의 변수 이름
4. scipy.io.loadmat
   matlab 파일인 .mat의 데이터를 로드한 함수 전달인자로 mat의 변수명을 받음
5. np.stack
   배열을 합치기 위해 사용됨
   전달인자인 axis는 차원을 나타내며, 2차원을 3차원으로 합쳐야 하기에 값은 1이다.
   -1로 설정한다면, 배열의 마지막 차원을 가르키는 것이며, 배열의 차원을 알지 목하거나 동적으로 처리할때 사용한다.
6. scipy.io.savemat
   matlab 파일인 .mat형식으로 파일을 저장함
### [160, 160, 394] 배열에 저장(절댓값)
위의 코드에서 np.abs() 함수만 추가되어 절댓값을 씌운 데이터를 저장하도록 함
```py
import scipy.io
import numpy as np
import os

directory = 'C:/Users/USER/Desktop/spectrum/asd'

mat_files = [os.path.join(directory, f) for f in os.listdir(directory) if f.endswith('.mat')]

data_list = []

for mat_file in mat_files:
    mat_data = scipy.io.loadmat(mat_file)
    data = mat_data['loaded_tensor_sub']
#절댓값을 씌움
    data = np.abs(data)
    data_list.append(data)

data_3d = np.stack(data_list, axis=1)

output_file = 'C:/Users/USER/Desktop/spectrum/output_data2.mat'
scipy.io.savemat(output_file, {'loaded_tensor_sub': data_3d})

print(f"3D 배열이 {output_file} 경로에 정상 저장되었습니다.")

```


### matlab에서 비교
```mat
load('C:/Users/USER/Desktop/spectrum/output_data.mat');

% 비교할 슬라이스 인덱스 
slice_indices = 1:9; 

figure; 
num_slices = length(slice_indices); 
num_rows = ceil(num_slices / 3); 
% 3개마다 개행 
for i = 1:num_slices 
	subplot(num_rows, 3, i); 
	imagesc(loaded_tensor_sub(:, :, slice_indices(i))); 
	colorbar; 
	title(['Slice ' num2str(slice_indices(i))]); 
end
```

### [160,160,2,394]배열로 합치기
```py
import scipy.io 
import numpy as np 

data_mat = scipy.io.loadmat('C:/Users/USER/Desktop/spectrum/output_data.mat') data_3d = data_mat['loaded_tensor_sub'] 
 
data_mat2 = scipy.io.loadmat('C:/Users/USER/Desktop/spectrum/output_data2.mat') data_3d2 = data_mat2['loaded_tensor_sub'] 

combined_data = np.stack((data_3d, data_3d2), axis=2)

output_file = 'C:/Users/USER/Desktop/spectrum/output_data3.mat' scipy.io.savemat(output_file, {'loaded_tensor_sub': combined_data}) 
print(f"합쳐진 배열이 {output_file} 경로로 저장되었습니다.")
```


### 최종 데이터 확인
```mat
load('C:/Users/USER/Desktop/spectrum/output_data3.mat'); 

% 차원 선택
data_3d_new = 0; 
slice_indices = 1:9; 
figure;
num_slices = length(slice_indices); 
num_rows = ceil(num_slices / 3);

for i = 1:num_slices 
	subplot(num_rows, 3, i); 
	% 차원 선택 
	if data_3d_new == 0 
		imagesc(squeeze(data_3d(:, :, 0, slice_indices(i)))); 
	elseif data_3d_new == 1 
		imagesc(squeeze(data_3d(:, :, 1, slice_indices(i)))); 
	end 
	colorbar; 
	title(['Slice ' num2str(slice_indices(i))]); 
end
```
6월 10일 까지
7분간 발표
